{% extends '_base_list.html' %}
{% load i18n %}
{% load static %}
{% block content_left_head %}{% endblock %}
{% block table_head %}
    <thead>
        <tr>
            <th>城市</th>
            <th>月份</th>
            <th>熔断次数</th>
            <th>故障时间</th>
            <th>操作</th>
        </tr>
    </thead>
{% endblock %}
{% block table_body %}
    <tbody>
    {% for record in city_month %}
        <tr>
            <td>{{record.city}}</td>
            <td>{{record.month}}</td>
            <td>{{record.pause_count}}</td>
            <td>{{record.total_pause_time}}</td>
            <td>
                <a class="btn btn-xs btn-primary btn-template" href="javascript:void(0)" id="{{record.id}}">生成报告</a>
                <a class="btn btn-xs btn-primary" href="#">编辑</a>
                <a class="btn btn-xs btn-danger" href="#">删除</a>
            </td>
        </tr>
    {% endfor %}
    </tbody>

    <!-- /.create-report-modal -->
    <div class="modal fade" tabindex="-1" role="dialog" id="dialog-create-report">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">设备网络运行报告</h4>
                </div>
                <div class="modal-body">
                    <form class="form-create-report">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">
                                    报告信息
                                </h3>
                            </div>
                            <ul class="list-group" id="report">
                            </ul>
                        </div>
                        {% csrf_token %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-close" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary btn-report">生成</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

{% endblock %}
{% block custom_foot_js %}
<script>
    jQuery(document).ready(function(){
        console.log('month record')
        $('body').on('click', '.btn-template', function(){
            var id = $(this).attr('id');
            console.log('create from template',id)
            $('#dialog-create-report').modal({show:true});
            //ajax获取城市月份数据填充到表格里面
            $.get("{% url 'api-dreport:get_month_record' %}", {'id':id}, function(result){
                console.log(result)
                if(result.code == 200){
                    console.log(result.data.city)
                    console.log(result.data.error_time)
                    console.log(result.data.month)
                    console.log(result.data.total_error)
                    var html = "<li class='list-group-item'>城市:" + result.data.city + "</li>"+"<li class='list-group-item'>月份:" + result.data.month + "</li>"+"<li class='list-group-item'>熔断次数:" + result.data.total_error + "</li>"+"<li class='list-group-item'>故障时间(秒):" + result.data.error_time + "</li>"+"<li class='list-group-item'>设备总数:" + "<input type='text' name='device' value=''>" + "</li>"+"<li class='list-group-item'>备注:" + "<input type='textarea' name='markdown' value=''>" + "</li>"

                    $('#report').append(html);
                }
            });

        });

        $('body').on('click', '.btn-close', function(){
            window.location.reload()
        });
    });
</script>
{% endblock %}
